{% load static %}
<!DOCTYPE html>

<html
>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />

    <title>DEENAS - Folder Contents</title>

    <meta name="description" content="" />

     <!-- Icons. Uncomment required icon fonts -->
     <link rel="icon" type="image/x-icon" href="{% static 'assets/img/favicon/bsu.ico' %}" />
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet"
    />

    <!-- Icons. Uncomment required icon fonts -->
    <link rel="stylesheet" href="{% static 'assets/vendor/fonts/boxicons.css' %}" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="{% static 'assets/vendor/css/core.css' %}" class="template-customizer-core-css" />
    <link rel="stylesheet" href="{% static 'assets/vendor/css/theme-default.css' %}" class="template-customizer-theme-css" />
    <link rel="stylesheet" href="{% static 'assets/css/demo.css' %}" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="{% static 'assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css' %}" />

    <!-- Page CSS -->

    <!-- Helpers -->
    <script src="{% static 'assets/vendor/js/helpers.js' %}"></script>

    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="{% static 'assets/js/config.js' %}"></script>
  </head>

  <body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">
        <!-- Menu -->

       
        {% include 'student/nav.html' %}

          <!-- / Navbar -->

          <!-- Content wrapper -->
          <div class="content-wrapper">
            <!-- Content -->

            <div class="container-xxl flex-grow-1 container-p-y">
              <h4 class="fw-bold py-3 mb-4">Folder Contents</h4>
              <div class="row mb-5">
              <div class="col-md-6">
<!-- Button trigger modal -->
<button
  href="#basicModal"
  class="btn btn-primary"
  data-bs-toggle="modal"
  data-bs-target="#basicModal"
>
<i class="bx bx-cloud-upload me-2" style="color: white; font-size: 22px; margin-top: -4px;"></i> Upload File
</button>

<!-- Modal -->
<!-- Modal -->
<div class="modal fade" id="basicModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel1">File Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form method="POST" enctype="multipart/form-data" onsubmit="return handleUpload(event)">
          {% csrf_token %}
       
        
          <div id="file-input-container" class="row g-2">
            <div class="col mb-0">
              <label for="file_name" class="form-label">File Name</label>
              <input type="text" name="file_name[]" class="form-control" placeholder="Enter File Name" required />
            </div>
            <div class="col mb-0">
              <label for="file_description" class="form-label">Description</label>
              <input type="text" name="file_description[]" class="form-control" placeholder="Enter Description" />
            </div>
            <div class="col mb-0">
              <label for="file_link" class="form-label">File Link</label>
              <input type="file" name="file_link[]" class="form-control" required />
            </div>
            <div class="col-auto mb-0">
              <button type="button" class="btn btn-danger remove-file-input" style="margin-top: 2rem;">Delete</button>
            </div>
          </div>
        
          <div class="modal-footer">
            <button type="button" id="add-file-btn" class="btn btn-success">Add File</button>
            <button type="submit" name="upload_file" class="btn btn-primary">Upload</button>
          </div>
        </form>
        
        <script>
          // Add file input row
          document.getElementById('add-file-btn').addEventListener('click', function() {
            const container = document.getElementById('file-input-container');
            const newRow = document.createElement('div');
            newRow.classList.add('row', 'g-2');
            newRow.innerHTML = `
              <div class="col mb-0">
                <label for="file_name" class="form-label">File Name</label>
                <input type="text" name="file_name[]" class="form-control" placeholder="Enter File Name" required />
              </div>
              <div class="col mb-0">
                <label for="file_description" class="form-label">Description</label>
                <input type="text" name="file_description[]" class="form-control" placeholder="Enter Description" />
              </div>
              <div class="col mb-0">
                <label for="file_link" class="form-label">File Link</label>
                <input type="file" name="file_link[]" class="form-control" required />
              </div>
              <div class="col-auto mb-0">
                <button type="button" class="btn btn-danger remove-file-input" style="margin-top: 2rem;">Delete</button>
              </div>
            `;
            container.appendChild(newRow);
        
            // Add event listener for the delete button
            const removeBtn = newRow.querySelector('.remove-file-input');
            removeBtn.addEventListener('click', function() {
              newRow.remove();
            });
          });
        
          // Handle form submission, you can add custom validation or processing here
          function handleUpload(event) {
            // Example: perform additional validation before submitting
            return true; // Proceed with form submission
          }
        </script>
      </div>
    </div>
  </div>
</div>


</div>
</div>
<p class="card-text">Search for Files:</p>

<input type="text " class="form-control" name="search-value" id="search-val"  placeholder="Search by name or description..." onkeyup="filterFiles()" />
<hr>
<select id="sortSelect" onchange="sortFiles()" class="btn btn-primary">
  <option value="name-asc">Sort by Name (A–Z)</option>
  <option value="name-desc">Sort by Name (Z–A)</option>
  <option value="date-desc">Sort by Date (Newest First)</option>
  <option value="date-asc">Sort by Date (Oldest First)</option>
</select>
<hr>

<script>
  let allItems = [];

  // Initialize on page load
  window.addEventListener('DOMContentLoaded', () => {
    const container = document.getElementById('folder-contents');
    allItems = Array.from(container.getElementsByClassName('file-item'));
    filterAndSort(); // Apply initial state
  });

  function filterAndSort() {
    const searchValue = document.getElementById('search-val').value.toLowerCase().trim();
    const sortValue = document.getElementById('sortSelect').value;

    let filteredItems = allItems.filter(item => {
      const name = item.querySelector('.file-name').textContent.toLowerCase();
      const description = item.querySelector('.file-description').textContent.toLowerCase();
      return name.includes(searchValue) || description.includes(searchValue);
    });

    filteredItems.sort((a, b) => {
      if (sortValue === 'name-asc' || sortValue === 'name-desc') {
        const nameA = a.querySelector('.file-name').textContent.replace('Name: ', '').toLowerCase();
        const nameB = b.querySelector('.file-name').textContent.replace('Name: ', '').toLowerCase();
        return sortValue === 'name-asc' ? nameA.localeCompare(nameB) : nameB.localeCompare(nameA);
      }

      if (sortValue === 'date-asc' || sortValue === 'date-desc') {
        const dateA = getDateFromItem(a);
        const dateB = getDateFromItem(b);
        return sortValue === 'date-asc' ? dateA - dateB : dateB - dateA;
      }

      return 0;
    });

    const container = document.getElementById('folder-contents');
    container.innerHTML = '';
    filteredItems.forEach(item => container.appendChild(item));
  }

  function getDateFromItem(item) {
    const paragraphs = item.querySelectorAll('.card-text');
    for (let p of paragraphs) {
      if (p.textContent.includes('Date Uploaded:')) {
        return new Date(p.textContent.replace('Date Uploaded: ', '').trim());
      }
    }
    return new Date(0);
  }

  function filterFiles() {
    filterAndSort();
  }

  function sortFiles() {
    filterAndSort();
  }
</script>
              <div class="row mb-5"   id="folder-contents">
              
                  {% for pdf in files.pdfs %}
                      <div class="col-md-6 col-xl-6 file-item" >
                          <div class="card mb-3">
                              <div class="card-body">
                                  <h5  class="card-title file-name d-flex justify-content-between">Name: {{ pdf.file_name }} ({{ pdf.file_link }}) <div class="dropdown ml-auto">
                                    <button class="btn btn-link " type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                                      <i class="bx bxs-cog text-danger"></i>
                                    </button>
                                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                      <li><a class="dropdown-item" href="{% url 'f_serve_file'  folder_code=folder_code filename=pdf.file_link  %}" download> Download</a></li>
                                      
                                    </ul>
                                  </div></h5>
                                  <p class="card-text file-description">Description: {{ pdf.file_description }}</p>
                                  <p class="card-text file-description">Date Uploaded: {{ pdf.uploaded_at }}</p>
                                  <iframe src="{% url 'f_serve_file' folder_code=folder_code filename=pdf.file_link  %}" style="width: 100%;" height="400"></iframe>

                              <hr>
          
                              </div>
                          </div>
                      </div>
                  {% endfor %}

                  {% for text in files.texts %}
                      <div class="col-md-6 col-xl-6 file-item" >
                          <div class="card mb-3">
                              <div class="card-body">
                                  <h5  class="card-title file-name d-flex justify-content-between">Name: {{ text.file_name }} ({{ text.file_link }}) <div class="dropdown ml-auto">
                                    <button class="btn btn-link " type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                                      <i class="bx bxs-cog text-danger"></i>
                                    </button>
                                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                      <li><a class="dropdown-item" href="{% url 'f_serve_file'  folder_code=folder_code filename=text.file_link  %}" download> Download</a></li>
                                      
                                    </ul>
                                  </div></h5>
                                  <p class="card-text file-description">Description: {{ text.file_description }}</p>
                                  <p class="card-text file-description">Date Uploaded: {{ text.uploaded_at }}</p>
                                  <object data="{% url 'f_serve_file' folder_code=folder_code filename=text.file_link  %}" style="width: 100%;" height="400"></object>

                              <hr>
                              
                              

                              </div>
                          </div>
                      </div>
                  {% endfor %}

                
                  {% for pdf in files.videos %}
                      <div class="col-md-6 col-xl-6 file-item" >
                          <div class="card mb-3">
                              <div class="card-body">
                                <h5 class="card-title file-name d-flex justify-content-between">
                                  Name: {{ pdf.file_name }} ({{ pdf.file_link }}) <div class="dropdown ml-auto">
                                    <button class="btn btn-link " type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                                      <i class="bx bxs-cog text-danger"></i>
                                    </button>
                                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                      <li><a class="dropdown-item" href="{% url 'f_serve_file'  folder_code=folder_code filename=pdf.file_link  %}" download> Download</a></li>
                                      
                                    </ul>
                                  </div></h5>
                                
                                  <p class="card-text file-description">Description: {{ pdf.file_description }}</p>
                                  <p class="card-text file-description">Date Uploaded: {{ pdf.uploaded_at }}</p>
                                  <video width="450" controls>
                                    <source src="{% url 'f_serve_file'  folder_code=folder_code filename=pdf.file_link  %}" type="video/mp4">
                                    Your browser does not support the video tag.
                                </video>

                              </div>
                          </div>
                      </div>
                  {% endfor %}
                 
                  {% for pdf in files.images %}
                      <div class="col-md-6 col-xl-6 file-item" >
                          <div class="card mb-3">
                              <div class="card-body">
                                  <h5  class="card-title file-name d-flex justify-content-between">Name: {{ pdf.file_name }} ({{ pdf.file_link }}) <div class="dropdown ml-auto">
                                    <button class="btn btn-link " type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                                      <i class="bx bxs-cog text-danger"></i>
                                    </button>
                                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                      <li><a class="dropdown-item" href="{% url 'f_serve_file'  folder_code=folder_code filename=pdf.file_link  %}" download> Download</a></li>
                                      
                                    </ul>
                                  </div></h5>
                                  <p class="card-text file-description">Description: {{ pdf.file_description }}</p>
                                  <p class="card-text file-description">Date Uploaded: {{ pdf.uploaded_at }}</p>
                                  <img style="width: 100%;"  src="{% url 'f_serve_file'  folder_code=folder_code filename=pdf.file_link  %}" width="300" alt="Image Preview">

                              <hr>
                         
                              </div>
                          </div>
                      </div>
                  {% endfor %}
              </div>
          </div>
          

              

          <script>
            function filterFiles() {
                let input = document.getElementById("search-val").value.toLowerCase();
                let items = document.querySelectorAll("#folder-contents .file-item");
            
                items.forEach(item => {
                    let name = item.querySelector(".file-name").textContent.toLowerCase();
                    let description = item.querySelector(".file-description").textContent.toLowerCase();
                    
                    if (name.includes(input) || description.includes(input)) {
                        item.style.display = "";
                    } else {
                        item.style.display = "none";
                    }
                });
            }
            </script>

    <!-- Core JS -->
    <!-- build:js assets/vendor/js/core.js -->
    <script src="{% static 'assets/vendor/libs/jquery/jquery.js' %}"></script>
    <script src="{% static 'assets/vendor/libs/popper/popper.js' %}"></script>
    <script src="{% static 'assets/vendor/js/bootstrap.js' %}"></script>
    <script src="{% static 'assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js' %}"></script>

    <script src="{% static 'assets/vendor/js/menu.js' %}"></script>
    <!-- endbuild -->

    <!-- Vendors JS -->
    <script src="{% static 'assets/vendor/libs/masonry/masonry.js' %}"></script>

    <!-- Main JS -->
    <script src="{% static 'assets/js/main.js' %}"></script>

    <!-- Page JS -->

    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js' %}"></script>
  </body>
</html>
